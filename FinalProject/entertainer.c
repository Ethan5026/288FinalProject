/*
 * entertainer.c
 *
 *  Created on: Nov 14, 2023
 *      Author: idenning
 */

#include "entertainer.h"
#include "open_interface.h"

unsigned char entertainer_notes[1584] = {79, 79, 81, 81, 77, 77, 74, 74, 76, 76, 72, 72, 67, 67, 69, 69, 65, 65, 62, 62, 64, 64, 60, 60, 55, 55, 57, 57, 53, 53, 50, 50, 64, 64, 62, 62, 61, 61, 60, 60,
                                         72, 72, 55, 55, 56, 56, 57, 57, 65, 65, 57, 57, 65, 65, 57, 57, 65, 65, 65, 65, 67, 67, 68, 68, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64, 67, 67, 65, 65, 55, 55,
                                         56, 56, 57, 57, 65, 65, 57, 57, 65, 65, 57, 57, 65, 65, 62, 62, 60, 60, 59, 59, 62, 62, 65, 65, 69, 69, 67, 67, 65, 65, 62, 62, 67, 67, 55, 55, 56, 56, 57, 57,
                                         65, 65, 57, 57, 65, 65, 57, 57, 65, 65, 65, 65, 67, 67, 68, 68, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64, 67, 67, 65, 65, 65, 65, 67, 67, 69, 69, 65, 65, 67, 67,
                                         69, 69, 65, 65, 67, 67, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 65, 65, 67, 67, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64, 67, 67, 65, 65, 55, 55, 56, 56,
                                         57, 57, 65, 65, 57, 57, 65, 65, 57, 57, 65, 65, 65, 65, 67, 67, 68, 68, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64, 67, 67, 65, 65, 55, 55, 56, 56, 57, 57, 65, 65,
                                         57, 57, 65, 65, 57, 57, 65, 65, 62, 62, 60, 60, 59, 59, 62, 62, 65, 65, 69, 69, 67, 67, 65, 65, 62, 62, 67, 67, 55, 55, 56, 56, 57, 57, 65, 65, 57, 57, 65, 65,
                                         57, 57, 65, 65, 65, 65, 67, 67, 68, 68, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64, 67, 67, 65, 65, 65, 65, 67, 67, 69, 69, 65, 65, 67, 67, 69, 69, 65, 65, 67, 67,
                                         65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 65, 65, 67, 67, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64, 67, 67, 65, 65, 57, 57, 58, 58, 59, 59, 60, 60, 62, 62,
                                         60, 60, 57, 57, 58, 58, 59, 59, 60, 60, 62, 62, 60, 60, 69, 69, 65, 65, 60, 60, 62, 62, 64, 64, 65, 65, 67, 67, 69, 69, 67, 67, 65, 65, 67, 67, 60, 60, 69, 69,
                                         70, 70, 72, 72, 74, 74, 72, 72, 69, 69, 70, 70, 72, 72, 74, 74, 72, 72, 69, 69, 70, 70, 71, 71, 72, 72, 74, 74, 72, 72, 72, 72, 74, 74, 75, 75, 76, 76, 76, 76,
                                         76, 76, 74, 74, 71, 71, 67, 67, 72, 72, 57, 57, 58, 58, 59, 59, 60, 60, 62, 62, 60, 60, 69, 69, 70, 70, 71, 71, 72, 72, 74, 74, 72, 72, 69, 69, 65, 65, 60, 60,
                                         62, 62, 64, 64, 65, 65, 67, 67, 69, 69, 67, 67, 65, 65, 67, 67, 65, 65, 60, 60, 59, 59, 60, 60, 65, 65, 62, 62, 65, 65, 62, 62, 65, 65, 62, 62, 60, 60, 65, 65,
                                         69, 69, 72, 72, 69, 69, 65, 65, 60, 60, 62, 62, 65, 65, 69, 69, 67, 67, 65, 65, 57, 57, 58, 58, 59, 59, 60, 60, 62, 62, 60, 60, 57, 57, 58, 58, 59, 59, 60, 60,
                                         62, 62, 60, 60, 69, 69, 65, 65, 60, 60, 62, 62, 64, 64, 65, 65, 67, 67, 69, 69, 67, 67, 65, 65, 67, 67, 60, 60, 69, 69, 70, 70, 72, 72, 74, 74, 72, 72, 69, 69,
                                         70, 70, 72, 72, 74, 74, 72, 72, 69, 69, 70, 70, 71, 71, 72, 72, 74, 74, 72, 72, 72, 72, 74, 74, 75, 75, 76, 76, 76, 76, 76, 76, 74, 74, 71, 71, 67, 67, 72, 72,
                                         57, 57, 58, 58, 59, 59, 60, 60, 62, 62, 60, 60, 69, 69, 70, 70, 71, 71, 72, 72, 74, 74, 72, 72, 69, 69, 65, 65, 60, 60, 62, 62, 64, 64, 65, 65, 67, 67, 69, 69,
                                         67, 67, 65, 65, 67, 67, 65, 65, 60, 60, 59, 59, 60, 60, 65, 65, 62, 62, 65, 65, 62, 62, 65, 65, 62, 62, 60, 60, 65, 65, 69, 69, 72, 72, 69, 69, 65, 65, 60, 60,
                                         62, 62, 65, 65, 69, 69, 67, 67, 65, 65, 55, 55, 56, 56, 57, 57, 65, 65, 57, 57, 65, 65, 57, 57, 65, 65, 65, 65, 67, 67, 68, 68, 69, 69, 65, 65, 67, 67, 69, 69,
                                         64, 64, 67, 67, 65, 65, 55, 55, 56, 56, 57, 57, 65, 65, 57, 57, 65, 65, 57, 57, 65, 65, 62, 62, 60, 60, 59, 59, 62, 62, 65, 65, 69, 69, 67, 67, 65, 65, 62, 62,
                                         67, 67, 55, 55, 56, 56, 57, 57, 65, 65, 57, 57, 65, 65, 57, 57, 65, 65, 65, 65, 67, 67, 68, 68, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64, 67, 67, 65, 65, 65, 65,
                                         67, 67, 69, 69, 65, 65, 67, 67, 69, 69, 65, 65, 67, 67, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 65, 65, 67, 67, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 64, 64,
                                         67, 67, 65, 65, 77, 77, 62, 62, 61, 61, 62, 62, 65, 65, 67, 67, 63, 63, 62, 62, 63, 63, 65, 65, 67, 67, 70, 70, 69, 69, 70, 70, 74, 74, 75, 75, 60, 60, 59, 59,
                                         60, 60, 62, 62, 63, 63, 67, 67, 72, 72, 67, 67, 72, 72, 67, 67, 65, 65, 70, 70, 69, 69, 73, 73, 76, 76, 81, 81, 79, 79, 76, 76, 77, 77, 74, 74, 75, 75, 74, 74,
                                         73, 73, 74, 74, 77, 77, 79, 79, 63, 63, 62, 62, 63, 63, 65, 65, 67, 67, 70, 70, 69, 69, 70, 70, 74, 74, 75, 75, 60, 60, 59, 59, 60, 60, 62, 62, 63, 63, 67, 67,
                                         72, 72, 67, 67, 72, 72, 67, 67, 65, 65, 70, 70, 70, 70, 74, 74, 77, 77, 72, 72, 65, 65, 67, 67, 69, 69, 70, 70, 64, 64, 65, 65, 67, 67, 69, 69, 70, 70, 72, 72,
                                         62, 62, 61, 61, 62, 62, 65, 65, 67, 67, 63, 63, 62, 62, 63, 63, 65, 65, 67, 67, 70, 70, 69, 69, 70, 70, 74, 74, 75, 75, 60, 60, 59, 59, 60, 60, 62, 62, 63, 63,
                                         67, 67, 72, 72, 67, 67, 72, 72, 67, 67, 65, 65, 70, 70, 69, 69, 73, 73, 76, 76, 81, 81, 79, 79, 76, 76, 77, 77, 74, 74, 75, 75, 74, 74, 73, 73, 74, 74, 77, 77,
                                         79, 79, 63, 63, 62, 62, 63, 63, 65, 65, 67, 67, 70, 70, 69, 69, 70, 70, 74, 74, 75, 75, 60, 60, 59, 59, 60, 60, 62, 62, 63, 63, 67, 67, 72, 72, 67, 67, 72, 72,
                                         67, 67, 65, 65, 70, 70, 70, 70, 74, 74, 77, 77, 72, 72, 65, 65, 67, 67, 69, 69, 70, 70, 82, 82, 65, 65, 62, 62, 65, 65, 62, 62, 65, 65, 62, 62, 60, 60, 65, 65,
                                         69, 69, 72, 72, 69, 69, 65, 65, 60, 60, 62, 62, 65, 65, 69, 69, 67, 67, 65, 65, 77, 77, 58, 58, 57, 57, 58, 58, 57, 57, 58, 58, 62, 62, 67, 67, 62, 62, 65, 65,
                                         67, 67, 65, 65, 62, 62, 60, 60, 59, 59, 60, 60, 59, 59, 60, 60, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 67, 67, 65, 65, 67, 67, 66, 66, 67, 67, 66, 66, 67, 67,
                                         70, 70, 74, 74, 70, 70, 72, 72, 74, 74, 72, 72, 70, 70, 65, 65, 65, 65, 65, 65, 77, 77, 74, 74, 72, 72, 60, 60, 60, 60, 60, 60, 60, 60, 58, 58, 57, 57, 58, 58,
                                         57, 57, 58, 58, 62, 62, 67, 67, 62, 62, 65, 65, 67, 67, 65, 65, 62, 62, 60, 60, 59, 59, 60, 60, 59, 59, 60, 60, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 67, 67,
                                         65, 65, 62, 62, 61, 61, 62, 62, 72, 72, 70, 70, 65, 65, 69, 69, 68, 68, 69, 69, 74, 74, 77, 77, 72, 72, 69, 69, 65, 65, 65, 65, 69, 69, 67, 67, 65, 65, 60, 60,
                                         60, 60, 60, 60, 60, 60, 58, 58, 57, 57, 58, 58, 57, 57, 58, 58, 62, 62, 67, 67, 62, 62, 65, 65, 67, 67, 65, 65, 62, 62, 60, 60, 59, 59, 60, 60, 59, 59, 60, 60,
                                         65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 67, 67, 65, 65, 67, 67, 66, 66, 67, 67, 66, 66, 67, 67, 70, 70, 74, 74, 70, 70, 72, 72, 74, 74, 72, 72, 70, 70, 65, 65,
                                         65, 65, 65, 65, 77, 77, 74, 74, 72, 72, 60, 60, 60, 60, 60, 60, 60, 60, 58, 58, 57, 57, 58, 58, 57, 57, 58, 58, 62, 62, 67, 67, 62, 62, 65, 65, 67, 67, 65, 65,
                                         62, 62, 60, 60, 59, 59, 60, 60, 59, 59, 60, 60, 65, 65, 69, 69, 65, 65, 67, 67, 69, 69, 67, 67, 65, 65, 62, 62, 61, 61, 62, 62, 72, 72, 70, 70, 65, 65, 69, 69,
                                         68, 68, 69, 69, 74, 74, 77, 77, 72, 72, 69, 69, 65, 65, 65, 65, 69, 69, 67, 67, 65, 65, 77, 77};

unsigned char entertainer_duration[1584] = {0, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 14, 1, 14, 1, 14, 1, 14, 17, 14, 1, 14, 1, 14, 1, 57, 6, 28, 3, 14, 1,
                                            14, 1, 14, 1, 28, 3, 14, 1, 28, 3, 14, 1, 94, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 86, 9, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 28,
                                            3, 14, 1, 102, 9, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 57, 38, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 28, 3, 14, 1, 94, 1, 14, 1, 14, 1,
                                            14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 86, 9, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14,
                                            1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 57, 38, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 28, 3, 14, 1, 94, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1,
                                            30, 1, 14, 1, 28, 3, 86, 9, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 28, 3, 14, 1, 102, 9, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 57, 38, 14,
                                            1, 14, 1, 14, 1, 28, 3, 14, 1, 28, 3, 14, 1, 94, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 86, 9, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1,
                                            30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 78, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14,
                                            1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14,
                                            1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 8, 8, 28, 3, 30, 1, 14, 1, 14, 1, 14, 1, 57, 22, 14,
                                            1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 57,
                                            22, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 15, 16, 15, 16, 8, 8, 28, 3, 73, 22, 14, 1,
                                            14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1,
                                            14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 8, 8, 28, 3, 30, 1, 14, 1,
                                            14, 1, 14, 1, 57, 22, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1,
                                            14, 1, 14, 1, 14, 1, 57, 22, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 15, 16, 15, 16, 8,
                                            8, 28, 3, 73, 38, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 28, 3, 14, 1, 94, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 86, 9, 14, 1, 14, 1, 14,
                                            1, 28, 3, 14, 1, 28, 3, 14, 1, 102, 9, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 57, 38, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 28, 3, 14, 1,
                                            73, 22, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 57, 38, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1,
                                            30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 28, 3, 57, 6, 28, 35, 14, 1, 14, 1, 57, 6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 14, 1,
                                            14, 1, 57, 6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 28, 3, 14, 1, 30, 1, 14, 1, 28, 3, 57, 6, 57, 6, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1,
                                            57, 6, 28, 35, 14, 1, 14, 1, 57, 6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 14, 1, 14, 1, 57, 6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 28,
                                            3, 14, 1, 30, 1, 14, 1, 28, 3, 57, 6, 43, 4, 14, 1, 14, 1, 28, 3, 30, 1, 14, 1, 14, 1, 14, 1, 15, 16, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 57,
                                            6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 14, 1, 14, 1, 57, 6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 28, 3, 14, 1, 30, 1, 14, 1, 28, 3,
                                            57, 6, 57, 6, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 57, 6, 28, 35, 14, 1, 14, 1, 57, 6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 14, 1, 14,
                                            1, 57, 6, 28, 3, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 15, 16, 28, 3, 14, 1, 30, 1, 14, 1, 28, 3, 57, 6, 43, 4, 14, 1, 14, 1, 28, 3, 30, 1, 14, 1, 14, 1, 14, 1, 57,
                                            6, 28, 35, 28, 3, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 15, 16, 15, 16, 14, 1, 43, 4, 57, 6, 28, 35, 28, 3, 14, 1,
                                            30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 28,
                                            3, 14, 1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 8, 8, 8, 8, 28, 3, 28, 3, 28, 3, 28, 3, 8, 8, 8, 8, 28, 3, 28, 3, 28, 3, 14, 1,
                                            30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14,
                                            1, 14, 1, 14, 1, 30, 1, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 28, 3, 14, 1, 28, 3, 45, 3, 8, 8, 8, 8, 28, 3, 28, 3, 28, 3, 14,
                                            1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1,
                                            28, 3, 14, 1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 8, 8, 8, 8, 28, 3, 28, 3, 28, 3, 28, 3, 8, 8, 8, 8, 28, 3, 28, 3, 28, 3,
                                            14, 1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 28, 3, 14, 1, 30, 1, 14, 1, 28, 19, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14, 1, 14,
                                            1, 14, 1, 14, 1, 14, 1, 30, 1, 28, 3, 14, 1, 14, 1, 14, 1, 14, 1, 30, 1, 14, 1, 14, 1, 14, 1, 28, 3, 28, 3, 14, 1, 28, 3, 45, 35, 28};

volatile int next_section = 0;

uint32_t section_duration(int notes, unsigned char* durations) {
    int i;
    uint32_t time = 0;
    for (i = 0; i < notes; i++) {
        time += durations[i];
    }
    return time * 254000;// + 10000000;
}

void WTIMER1B_Handler() {
    WTIMER1_TBMATCHR_R = 0xFFFFFFFF - section_duration(48, entertainer_duration + 48*next_section);
    oi_loadSong(next_section%2, 48, entertainer_notes + 48*next_section, entertainer_duration + 48*next_section);
    oi_play_song(next_section%2);

    WTIMER1_ICR_R |= 0x800;
    WTIMER1_CTL_R &= ~0x100; // enable
    WTIMER1_TBILR_R = 0xFFFFFFFF; // Timer B Load full
    WTIMER1_CTL_R |= 0x100; // enable

    next_section = (next_section + 1) % 33;
}

void entertainer_init() {
    SYSCTL_RCGCGPIO_R |= 0b100; // Turn on port C for the wide timer 1B
    GPIO_PORTC_DEN_R |= 0x80; // Turn on pin 7 of Port C
    GPIO_PORTC_DIR_R |= 0x80; // Make output pin 7 of Port C
    GPIO_PORTC_AFSEL_R |= 0x80; // Turn on alternate function
    GPIO_PORTC_PCTL_R  &= ~0xF0000000; // Clear the alternate function for Port C pin 7
    GPIO_PORTC_PCTL_R  |= 0x70000000; // Set alternate function for Port C pin 7 to wide timer 1B
    SYSCTL_RCGCWTIMER_R |= 0b10; // Turn on the timer clock for wide timer 1
    timer_waitMillis(10);
    WTIMER1_CFG_R = 0x4; // Basic configuration 32 bit
    WTIMER1_TBMR_R = 0x122; // Interval Load, Match Interrupt, Periodic Mode
    WTIMER1_CTL_R &= ~0x100; // disable
    WTIMER1_IMR_R = 0x800; // Timer B match interrupt
    NVIC_EN3_R |= 0b10; // Enable Timer 1B interrupts
    WTIMER1_TBILR_R = 0xFFFFFFFF; // Timer B Load full
    WTIMER1_TBMATCHR_R = 0x00000000; // Match at empty
    IntRegister(INT_WTIMER1B, WTIMER1B_Handler);
    IntMasterEnable();
}

void entertainer_play(oi_t* oi) {

    int i;
    for (i = 0; i < 1584; i++) {
        if (entertainer_duration[i] < 4) {
            entertainer_duration[i] = 4;
        }
    }

    WTIMER1_CTL_R |= 0x100; // enable wide timer
    next_section = 0;
    WTIMER1B_Handler();
}

void entertainer_pause() {
    WTIMER1_CTL_R &= ~0x100;
}
